# π” μµλ… DM λ©λ΅ ν‘μ‹ μ• λλ” λ¬Έμ  - μ§„λ‹¨ μ™„λ£

## π“ λ¬Έμ  μ§„λ‹¨

### λ°κ²¬λ μ›μΈ
**μ¤‘λ³µ ν•„ν„°λ§ λ¬Έμ !**

```dart
// β λ¬Έμ : ν΄λΌμ΄μ–ΈνΈμ—μ„ archivedByλ¥Ό λ‹¤μ‹ μ²΄ν¬
// lib/screens/dm_list_screen.dart:156
final notArchivedServer = !(c.archivedBy.contains(_currentUser!.uid));
final result = passesType && notHiddenLocal && notArchivedServer && hasOtherParticipant;
```

### λ°μ΄ν„° νλ¦„ λ¶„μ„

```
1οΈβƒ£ μ„λ²„ ν•„ν„°λ§ (getMyConversations)
   β… archivedBy μ²΄ν¬
   β… μƒ λ©”μ‹μ§€ μμΌλ©΄ β†’ λ³µμ›ν•μ—¬ λ°ν™
   
2οΈβƒ£ ν΄λΌμ΄μ–ΈνΈ ν•„ν„°λ§ (dm_list_screen)
   β archivedByλ¥Ό λ‹¤μ‹ μ²΄ν¬
   β μ„λ²„μ—μ„ λ³µμ›ν• λ€ν™”λ°©μ„ λ‹¤μ‹ μ¨κΉ€!
```

### μ‹¤μ  μ‹λ‚λ¦¬μ¤

```
μ‹κ°„μμ„:
1. μ‚¬μ©μκ°€ μ±„ν…λ°© λ‚κ°€κΈ°
   β†’ archivedBy: [userId]
   β†’ μ„λ²„ ν•„ν„°: μ¨κΉ€ β…

2. μƒλ€λ°©μ΄ μƒ λ©”μ‹μ§€ μ „μ†΅
   β†’ lastMessageTime > userLeftTime
   β†’ μ„λ²„ ν•„ν„°: λ³µμ›ν•μ—¬ λ°ν™ β…
   
3. ν΄λΌμ΄μ–ΈνΈ ν•„ν„°λ§
   β†’ archivedBy.contains(userId) == true
   β†’ ν΄λΌμ΄μ–ΈνΈ ν•„ν„°: λ‹¤μ‹ μ¨κΉ€ βββ
   
κ²°κ³Ό: μ•λ¦ΌμΌλ΅λ” λ³΄μ΄μ§€λ§ λ©λ΅μ—λ” μ• λ³΄μ„
```

---

## β… ν•΄κ²° λ°©λ²•

### **μ¤‘λ³µ ν•„ν„°λ§ μ κ±°**

#### Before (λ¬Έμ )
```dart
final notArchivedServer = !(c.archivedBy.contains(_currentUser!.uid));
final result = passesType && notHiddenLocal && notArchivedServer && hasOtherParticipant;
```

#### After (ν•΄κ²°)
```dart
// β… archivedBy μ²΄ν¬ μ κ±°: getMyConversationsμ—μ„ μ΄λ―Έ μ²λ¦¬λ¨
final result = passesType && notHiddenLocal && hasOtherParticipant;
```

---

## π“ ν•„ν„°λ§ μ±…μ„ λ¶„λ¦¬

### **μ„λ²„ ν•„ν„° (getMyConversations)**
- β… `archivedBy` μ²΄ν¬ + μλ™ λ³µμ›
- β… `userLeftAt` μ²΄ν¬ + μλ™ λ³µμ›
- β… μµλ… λ€ν™”λ°© νΉμ μ²λ¦¬

### **ν΄λΌμ΄μ–ΈνΈ ν•„ν„° (dm_list_screen)**
- β… μΉκµ¬/μµλ… νƒ­ κµ¬λ¶„
- β… λ΅μ»¬ μ¨κΉ€ μ²΄ν¬
- β… μ°Έμ—¬μ μ μ²΄ν¬
- β ~~archivedBy μ²΄ν¬~~ (μ κ±°!)

---

## π― μμƒ λ™μ‘

### **λ‚κ°€κΈ° ν›„ μƒ λ©”μ‹μ§€**
```
1. μ„λ²„ ν•„ν„°:
   πΆ [λ€ν™”λ°©] ν‘μ‹: archivedByμ΄μ§€λ§ μƒ λ©”μ‹μ§€λ΅ λ³µμ›
   
2. ν΄λΌμ΄μ–ΈνΈ ν•„ν„°:
   β… ν¬ν•¨: [λ€ν™”λ°©ID] (μµλ…)
   
3. κ²°κ³Ό:
   β… DM μµλ… νƒ­μ— ν‘μ‹λ¨!
```

---

## π§ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

1. **λ‚κ°€κΈ° ν…μ¤νΈ**
   - [ ] μ±„ν…λ°© λ‚κ°€κΈ° β†’ μ¦‰μ‹ λ©λ΅μ—μ„ μ κ±° ν™•μΈ

2. **λ³µμ› ν…μ¤νΈ**
   - [ ] λ‹¤λ¥Έ κ³„μ •μΌλ΅ λ©”μ‹μ§€ μ „μ†΅
   - [ ] μ•λ¦Ό λ„μ°© ν™•μΈ
   - [ ] DM μµλ… νƒ­μ— ν‘μ‹ ν™•μΈ β…

---

## π“ ν•µμ‹¬ κµν›

### **λ‹¨μΌ μ±…μ„ μ›μΉ™**
- μ„λ²„ ν•„ν„°: λ°μ΄ν„° κ°€μ‹μ„± κ²°μ • (archivedBy, userLeftAt)
- ν΄λΌμ΄μ–ΈνΈ ν•„ν„°: UI ν‘μ‹ λ¶„λ¥ (μΉκµ¬/μµλ…, λ΅μ»¬ μ¨κΉ€)

### **μ¤‘λ³µ λ΅μ§ μ κ±°**
- κ°™μ€ μ΅°κ±΄μ„ λ‘ κ³³μ—μ„ μ²΄ν¬ν•λ©΄ μ• λ¨
- λ³µμ΅ν• λ΅μ§(λ³µμ› λ“±)μ€ ν• κ³³μ—μ„λ§ μ²λ¦¬

---

## β… μμ • μ™„λ£

- β… `lib/screens/dm_list_screen.dart`
  - μ¤‘λ³µ `archivedBy` μ²΄ν¬ μ κ±°
  - λ΅κ·Έ λ©”μ‹μ§€ μ—…λ°μ΄νΈ

---

μ™„λ£! μ΄μ  μƒ λ©”μ‹μ§€κ°€ μ¤λ©΄ DM λ©λ΅μ— μ •μƒμ μΌλ΅ ν‘μ‹λ©λ‹λ‹¤! π‰
